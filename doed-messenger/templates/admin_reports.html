<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doed Admin - –ñ–∞–ª–æ–±—ã</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',sans-serif;}
        :root{
            --red:#e63946;--dark-red:#d00000;--blue:#4a6fa5;--dark:#1a1a2e;
            --light:#16213e;--text:#f1faee;--gray:#a8dadc;--border:#2d3047;
            --green:#32CD32;--yellow:#ffd700;--purple:#8a2be2;
        }
        body{background:var(--dark);color:var(--text);}
        .header{
            background:var(--light);
            padding:20px;
            border-bottom:3px solid var(--red);
            display:flex;
            justify-content:space-between;
            align-items:center;
        }
        .container{display:flex;min-height:100vh;}
        .sidebar{
            width:250px;
            background:var(--light);
            padding:20px;
            border-right:2px solid var(--border);
        }
        .sidebar a{
            display:block;
            color:var(--text);
            text-decoration:none;
            padding:12px 15px;
            margin:5px 0;
            border-radius:8px;
            transition:all 0.3s;
        }
        .sidebar a:hover{
            background:var(--red);
            transform:translateX(5px);
        }
        .sidebar a.active{
            background:var(--red);
        }
        .content{
            flex:1;
            padding:20px;
        }
        .content h2{
            margin-bottom:20px;
            color:var(--red);
        }
        .filter-form{
            margin-bottom:20px;
            display:flex;
            gap:10px;
        }
        .filter-select{
            padding:10px;
            background:var(--light);
            border:2px solid var(--border);
            color:var(--text);
            border-radius:5px;
        }
        .reports-container{
            display:flex;
            flex-direction:column;
            gap:20px;
        }
        .report-card{
            background:var(--light);
            border-radius:10px;
            border-left:4px solid var(--red);
            overflow:hidden;
        }
        .report-header{
            background:rgba(230,57,70,0.2);
            padding:15px;
            display:flex;
            justify-content:space-between;
            align-items:center;
            border-bottom:2px solid var(--border);
        }
        .report-info{
            display:flex;
            gap:20px;
            flex-wrap:wrap;
        }
        .report-badge{
            padding:5px 10px;
            border-radius:15px;
            font-size:12px;
            font-weight:bold;
        }
        .status-pending{
            background:var(--yellow);
            color:black;
        }
        .status-reviewed{
            background:var(--green);
            color:white;
        }
        .status-rejected{
            background:var(--gray);
            color:white;
        }
        .status-muted{
            background:var(--purple);
            color:white;
        }
        .status-banned{
            background:var(--red);
            color:white;
        }
        .report-message{
            padding:15px;
            background:var(--dark);
            margin:10px;
            border-radius:8px;
            border-left:3px solid var(--red);
        }
        .report-reason{
            padding:0 15px 10px;
            color:var(--gray);
            font-style:italic;
        }
        .context-container{
            padding:15px;
            background:rgba(0,0,0,0.3);
            margin:10px;
            border-radius:8px;
        }
        .context-title{
            color:var(--gray);
            margin-bottom:10px;
            font-size:14px;
        }
        .context-messages{
            display:flex;
            flex-direction:column;
            gap:8px;
            max-height:200px;
            overflow-y:auto;
            padding:5px;
        }
        .context-message{
            padding:8px;
            border-radius:5px;
            font-size:13px;
        }
        .context-message.reporter{
            background:rgba(230,57,70,0.1);
            border-left:2px solid var(--red);
        }
        .context-message.reported{
            background:rgba(138,43,226,0.1);
            border-left:2px solid var(--purple);
        }
        .context-message .sender{
            font-weight:bold;
            margin-bottom:3px;
            font-size:11px;
        }
        .context-message .time{
            font-size:10px;
            color:var(--gray);
            text-align:right;
        }
        .report-actions{
            padding:15px;
            display:flex;
            gap:10px;
            flex-wrap:wrap;
            border-top:2px solid var(--border);
        }
        .btn{
            padding:8px 16px;
            border-radius:5px;
            border:none;
            cursor:pointer;
            font-size:13px;
            transition:all 0.3s;
        }
        .btn-success{
            background:var(--green);
            color:white;
        }
        .btn-success:hover{
            background:#2ecc71;
            transform:translateY(-2px);
        }
        .btn-warning{
            background:var(--yellow);
            color:black;
        }
        .btn-warning:hover{
            background:#f39c12;
            transform:translateY(-2px);
        }
        .btn-mute{
            background:var(--purple);
            color:white;
        }
        .btn-mute:hover{
            background:#9b59b6;
            transform:translateY(-2px);
        }
        .btn-danger{
            background:var(--red);
            color:white;
        }
        .btn-danger:hover{
            background:var(--dark-red);
            transform:translateY(-2px);
        }
        .mute-input{
            width:60px;
            padding:5px;
            background:var(--dark);
            border:2px solid var(--border);
            color:var(--text);
            border-radius:5px;
            text-align:center;
        }
        .stats{
            display:grid;
            grid-template-columns:repeat(auto-fit, minmax(150px, 1fr));
            gap:15px;
            margin-bottom:30px;
        }
        .stat-card{
            background:var(--light);
            padding:15px;
            border-radius:10px;
            border-left:3px solid var(--red);
        }
        .stat-value{
            font-size:28px;
            font-weight:bold;
            color:var(--red);
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üî¥ Doed Admin Panel - –ñ–∞–ª–æ–±—ã</h1>
        <div style="display:flex; gap:10px;">
            <span class="report-badge status-pending">–û–∂–∏–¥–∞–µ—Ç: {{ reports|selectattr('status', 'equalto', 'pending')|list|length }}</span>
            <span class="report-badge status-muted">–í –º—É—Ç–µ: {{ reports|selectattr('status', 'equalto', 'muted')|list|length }}</span>
        </div>
    </div>
    <div class="container">
        <div class="sidebar">
            <a href="/admin/">üè† –ì–ª–∞–≤–Ω–∞—è</a>
            <a href="/admin/users">üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a>
            <a href="/admin/messages">üí¨ –°–æ–æ–±—â–µ–Ω–∏—è</a>
            <a href="/admin/reports" class="active">‚ö†Ô∏è –ñ–∞–ª–æ–±—ã</a>
            <a href="/chat">‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ —á–∞—Ç</a>
            <a href="/logout">üö™ –í—ã–π—Ç–∏</a>
        </div>
        <div class="content">
            <h2>–ñ–∞–ª–æ–±—ã –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è</h2>
            
            <form class="filter-form" method="get">
                <select name="status" class="filter-select" onchange="this.form.submit()">
                    <option value="pending" {% if current_status == 'pending' %}selected{% endif %}>‚è≥ –û–∂–∏–¥–∞—é—Ç</option>
                    <option value="reviewed" {% if current_status == 'reviewed' %}selected{% endif %}>‚úÖ –†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω—ã</option>
                    <option value="rejected" {% if current_status == 'rejected' %}selected{% endif %}>‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω—ã</option>
                    <option value="muted" {% if current_status == 'muted' %}selected{% endif %}>üîá –í –º—É—Ç–µ</option>
                    <option value="banned" {% if current_status == 'banned' %}selected{% endif %}>üî® –ó–∞–±–∞–Ω–µ–Ω—ã</option>
                    <option value="all" {% if current_status == 'all' %}selected{% endif %}>üìã –í—Å–µ</option>
                </select>
            </form>
            
            <div class="reports-container">
                {% for report in reports %}
                <div class="report-card">
                    <div class="report-header">
                        <div class="report-info">
                            <span>üìù –ñ–∞–ª–æ–±–∞ #{{ report.id }}</span>
                            <span>üë§ –û—Ç: {{ report.reporter.username }} (@{{ report.reporter.tag }})</span>
                            <span>üë§ –ù–∞: {{ report.reported.username }} (@{{ report.reported.tag }})</span>
                            <span class="report-badge status-{{ report.status }}">{{ report.status }}</span>
                        </div>
                        <div>{{ report.created_at.strftime('%Y-%m-%d %H:%M') }}</div>
                    </div>
                    
                    <div class="report-message">
                        <strong>üí¨ –°–æ–æ–±—â–µ–Ω–∏–µ:</strong>
                        <p style="margin-top:5px;">
                            {% if report.message.is_file %}
                                üìÅ {{ report.message.file_name }}
                            {% else %}
                                {{ report.message.content }}
                            {% endif %}
                        </p>
                    </div>
                    
                    <div class="report-reason">
                        <strong>‚ö†Ô∏è –ü—Ä–∏—á–∏–Ω–∞:</strong> {{ report.reason }}
                    </div>
                    
                    <!-- –ö–û–ù–¢–ï–ö–°–¢ –°–û–û–ë–©–ï–ù–ò–ô -->
                    <div class="context-container">
                        <div class="context-title">üìã –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø–µ—Ä–µ–ø–∏—Å–∫–∏ (30 –º–∏–Ω—É—Ç –¥–æ/–ø–æ—Å–ª–µ):</div>
                        <div class="context-messages">
                            {% for msg in report.context %}
                            <div class="context-message {% if msg.sender_id == report.reporter_id %}reporter{% else %}reported{% endif %}">
                                <div class="sender">
                                    {% if msg.sender_id == report.reporter_id %}
                                        üë§ {{ report.reporter.username }} (–∂–∞–ª–æ–±—â–∏–∫):
                                    {% else %}
                                        üë§ {{ report.reported.username }} (–Ω–∞—Ä—É—à–∏—Ç–µ–ª—å):
                                    {% endif %}
                                </div>
                                <div>
                                    {% if msg.is_file %}
                                        üìÅ {{ msg.file_name }}
                                    {% else %}
                                        {{ msg.content }}
                                    {% endif %}
                                </div>
                                <div class="time">{{ msg.timestamp.strftime('%H:%M:%S') }}</div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    
                    {% if report.status == 'pending' %}
                    <div class="report-actions">
                        <form method="post" action="/admin/reports/{{ report.id }}/review" style="display:inline;">
                            <input type="hidden" name="action" value="approve">
                            <button type="submit" class="btn btn-success" onclick="return confirm('–û–¥–æ–±—Ä–∏—Ç—å –∂–∞–ª–æ–±—É?')">‚úÖ –û–¥–æ–±—Ä–∏—Ç—å</button>
                        </form>
                        
                        <form method="post" action="/admin/reports/{{ report.id }}/review" style="display:inline;">
                            <input type="hidden" name="action" value="reject">
                            <button type="submit" class="btn btn-warning" onclick="return confirm('–û—Ç–∫–ª–æ–Ω–∏—Ç—å –∂–∞–ª–æ–±—É?')">‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
                        </form>
                        
                        <form method="post" action="/admin/reports/{{ report.id }}/review" style="display:inline;">
                            <input type="hidden" name="action" value="mute">
                            <input type="number" name="mute_minutes" value="10" min="1" max="60" class="mute-input"> –º–∏–Ω
                            <button type="submit" class="btn btn-mute" onclick="return confirm('–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ –º—É—Ç –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è?')">üîá –í –º—É—Ç (—Ç–æ–ª—å–∫–æ –±–æ—Ç—ã)</button>
                        </form>
                        
                        <form method="post" action="/admin/reports/{{ report.id }}/review" style="display:inline;">
                            <input type="hidden" name="action" value="ban">
                            <button type="submit" class="btn btn-danger" onclick="return confirm('–ó–∞–±–∞–Ω–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?')">üî® –ó–∞–±–∞–Ω–∏—Ç—å</button>
                        </form>
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</body>
</html>